---
description: PostHog events: capture user interactions and centralize names in POSTHOG_EVENTS
globs: "src/**/*.ts,src/**/*.tsx"
alwaysApply: false
---

# PostHog events - PandaTrack

## When to add events

Default to adding a PostHog event for any meaningful user interaction, especially:

- CTA and button clicks
- Navigation actions (menu open/close, nav item clicks)
- Form interactions (submit attempt, success, failure, validation failure)
- UI toggles (accordion open/close, filters, tabs, switches)
- Key conversion milestones and drop-off points

Avoid tracking extremely noisy events (hover, every keypress) unless explicitly needed.

## Centralize event names

- Never hardcode PostHog event name strings inside components or server actions.
- Every event name must live in `POSTHOG_EVENTS` in `src/lib/constants.ts`.

## Grouping rules for POSTHOG_EVENTS

- First level grouping is by page/surface (examples: `LANDING`, `DASHBOARD`, `SETTINGS`).
- Second level grouping is by feature/module when helpful (examples: `WAITLIST`, `MENU`, `FAQ`).
- Keys are `UPPER_SNAKE_CASE`. Event values are `snake_case` strings.

Example:

```typescript
export const POSTHOG_EVENTS = {
  LANDING: {
    WAITLIST: {
      SUBMITTED: "waitlist_submitted",
      SUCCESS: "waitlist_success",
      FAILED: "waitlist_failed",
    },
  },
} as const;
```

## Usage

- Preferred (clicks): add `data-ph-event` and optional `data-ph-props` to the clickable element. A global click delegate will call `posthog.capture(...)`.
- Client (manual): `posthog.capture(POSTHOG_EVENTS.<PAGE>.<...>, properties)`
- Server: `posthog.capture({ distinctId, event: POSTHOG_EVENTS.<PAGE>.<...>, properties })`

### Global click delegate (preferred for simple clicks)

For simple click tracking (CTAs, nav links, social links), prefer declarative attributes instead of inline `onClick` handlers:

- `data-ph-event`: required, the event name (use `POSTHOG_EVENTS`)
- `data-ph-props`: optional, JSON-serialized object of event properties

Example (any element):

```tsx
<button
  data-ph-event={POSTHOG_EVENTS.LANDING.CTA_CLICKED}
  data-ph-props='{"location":"hero","cta_type":"primary"}'
>
  Join the waitlist
</button>
```

Example (`AnchorLink` helper props):

```tsx
<AnchorLink
  href="#waitlist"
  posthogEvent={POSTHOG_EVENTS.LANDING.CTA_CLICKED}
  posthogProps={{ location: "hero", cta_type: "primary" }}
>
  Join the waitlist
</AnchorLink>
```

### When to use manual `posthog.capture(...)`

Use manual capture when the event properties require runtime logic, validation, or state inspection that is not conveniently expressed as static `data-*` attributes, for example:

- form submit attempts where you want to include derived properties (e.g. `has_comment`)
- toggle events where `action` depends on current state
- server actions (success/failure events captured on the server)

## Event properties

- Use `snake_case` property keys.
- Prefer non-PII properties (booleans, enums, counts).
- Include context that helps analysis: `location`, `cta_type`, `destination`, `action`, `locale`.
